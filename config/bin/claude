#!/usr/bin/env bash
#
# claude - Claude Code wrapper that runs via claude-chill
#
# Automatically wraps the real claude command with claude-chill
# to tame massive terminal updates.
#
set -euo pipefail

# Find the real claude binary, skipping this wrapper
find_real_claude() {
  local self
  self="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/$(basename "${BASH_SOURCE[0]}")"

  local IFS=':'
  for dir in $PATH; do
    local candidate="${dir}/claude"
    if [[ -x "$candidate" && "$(realpath "$candidate")" != "$(realpath "$self")" ]]; then
      echo "$candidate"
      return
    fi
  done

  echo "error: could not find the real claude binary in PATH" >&2
  return 1
}

real_claude="$(find_real_claude)"

if command -v claude-chill > /dev/null 2>&1; then
  exec claude-chill -- "$real_claude" "$@"
else
  exec "$real_claude" "$@"
fi
