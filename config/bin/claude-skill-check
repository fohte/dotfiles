#!/bin/bash
# Condition checker for Claude Code skill bang commands.
# Usage: claude-skill-check <check> [args...]
#
# Checks:
#   is-public              Exit 0 if repo visibility is PUBLIC
#   is-private             Exit 0 if repo visibility is PRIVATE
#   is-owner <login>       Exit 0 if repo owner matches <login>
#   has-file <path>        Exit 0 if file exists (alias for [ -f ])

set -euo pipefail

check="${1:?Usage: claude-skill-check <check> [args...]}"
shift

case "$check" in
  is-public)
    visibility=$(gh repo view --json visibility --jq .visibility 2> /dev/null || true)
    [ "$visibility" = "PUBLIC" ]
    ;;
  is-private)
    visibility=$(gh repo view --json visibility --jq .visibility 2> /dev/null || true)
    [ "$visibility" = "PRIVATE" ]
    ;;
  is-owner)
    owner=$(gh repo view --json owner --jq .owner.login 2> /dev/null || true)
    [ "$owner" = "${1:?Usage: claude-skill-check is-owner <login>}" ]
    ;;
  has-file)
    [ -f "${1:?Usage: claude-skill-check has-file <path>}" ]
    ;;
  *)
    echo "Unknown check: $check" >&2
    exit 2
    ;;
esac
